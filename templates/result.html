<!DOCTYPE html>
<html>
<head>
    <title>DFA Equivalence Result</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        #toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); z-index: 2000;
                background: #1f3c88; color: #fff; padding: 12px 18px; border-radius: 10px; display:none; }
    </style>
</head>
<body>
<div class="container" style="max-width:980px; margin-top:30px;">
    <h1 class="text-center mb-4">Result</h1>

    {% if equivalent %}
        <p class="text-center text-success fs-4">✅ The DFAs are equivalent.</p>
    {% else %}
        <p class="text-center text-danger fs-4">❌ The DFAs are NOT equivalent.</p>
        <p class="text-center fs-5">Counterexample string: <strong>{{ counterexample }}</strong></p>
    {% endif %}

    <div class="row mt-4">
        <div class="col-md-6 text-center">
            <h3>DFA 1</h3>
            <img src="{{ img1 }}" alt="DFA 1">
        </div>
        <div class="col-md-6 text-center">
            <h3>DFA 2</h3>
            <img src="{{ img2 }}" alt="DFA 2">
        </div>
    </div>

    <div class="text-center mt-4">
        <a href="/" class="btn btn-primary">Check Another DFA</a>
    </div>
</div>

<div id="toast">Saved to history</div>

<script>
(function(){
    try {
        // Full raw inputs were passed from app.py as raw1/raw2 objects
        const dfa1 = {{ raw1|tojson }};
        const dfa2 = {{ raw2|tojson }};
        const equivalent = {{ 'true' if equivalent else 'false' }};
        const counterexample = {{ counterexample|tojson }};
        const resultText = equivalent ? '✅ Equivalent' : '❌ Not Equivalent';
        const timestamp = new Date().toLocaleString();

        // Build entry
        const entry = {
            dfa1: dfa1,
            dfa2: dfa2,
            result: resultText,
            time: timestamp,
            counterexample: counterexample
        };

        let history = JSON.parse(localStorage.getItem('dfaHistory')) || [];

        // Put newest at front. If same raw inputs already at front, update it
        if (history.length && JSON.stringify(history[0].dfa1) === JSON.stringify(dfa1) &&
            JSON.stringify(history[0].dfa2) === JSON.stringify(dfa2)) {
            history[0] = entry;
        } else {
            history.unshift(entry);
        }

        if (history.length > 5) history = history.slice(0, 5);
        localStorage.setItem('dfaHistory', JSON.stringify(history));

        // toast
        const toast = document.getElementById('toast');
        toast.style.display = 'block';
        setTimeout(()=>{ toast.style.display = 'none'; }, 2500);
    } catch (e) {
        console.error('Could not save history', e);
    }
})();
</script>
</body>
</html>
